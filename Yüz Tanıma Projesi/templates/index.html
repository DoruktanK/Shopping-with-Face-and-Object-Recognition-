<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>YÃ¼z TanÄ±ma Paneli</title>
    <link href="../static/coreui-5.3.1-dist/css/coreui.min.css" rel="stylesheet" />
    <style>
      body {
        background-color: #121212;
        color: #e0e0e0;
        font-family: "Segoe UI", "Roboto", "Helvetica Neue", sans-serif;
        font-size: 16px;
      }

      .card {
        background-color: #1e1e1e;
        color: #e0e0e0;
        border: 1px solid #2c2c2c;
      }

      .form-control {
        background-color: #2a2a2a;
        border: 1px solid #444;
        color: #fff;
      }

      .form-control:focus {
        background-color: #2a2a2a;
        border-color: #888;
        color: #fff;
      }

      .nav-tabs .nav-link {
        background-color: #1e1e1e;
        color: #ccc;
        border: 1px solid #2c2c2c;
      }

      .nav-tabs .nav-link.active {
        background-color: #333;
        color: #fff;
        border-color: #888 #888 #2c2c2c;
      }

      .table {
      background-color: #1e1e1e;
      color: #e0e0e0;
      }

     .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #2c2c2c;
      }

      .table-striped > tbody > tr:nth-of-type(even) {
      background-color: #1e1e1e;
      }

     .table th,
     .table td {
      border-color: #444;
      }

      

      .btn-warning {
        background-color: #f57c00;
        border: none;
        font-weight: bold;
        font-size: 16px;
      }

      .btn-success {
        font-weight: bold;
        font-size: 16px;
      }

      .toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1055;
      }

      .toast {
        background-color: #333;
        color: #fff;
      }
     
      .admin-content {
        display: none; /* ilk baÅŸta tamamen gÃ¶rÃ¼nmez */
        }
      #adminLoginPanel {
        transition: all 0.3s ease; /* yumuÅŸak geÃ§iÅŸ */
       
       }

      #adminLoginPanel.hidden {
        display: none !important;
       }
     
     

</style>

    </style>
  </head>
  <body class="c-app">
    <!-- Ãœst MenÃ¼ -->
    <div class="c-wrapper">
      <header class="c-header c-header-dark c-header-fixed">
        <div class="container-fluid">
          <h4 class="m-2 text-white"> YÃ¼z TanÄ±ma & MÃ¼ÅŸteri YÃ¶netim Paneli</h4>
        </div>
      </header>

<div class="c-body">
  <main class="container mt-4">
    <!-- ADMIN PANEL (BAÅžLANGIÃ‡) -->
    <div id="adminLoginPanel" style="display: none; background: #1e1e1e; padding: 1rem; border: 1px solid #444; margin-bottom: 1rem;">
      <h5>ðŸ”’ Admin GiriÅŸi</h5>
      <input type="text" id="adminUser" class="form-control mb-2" placeholder="KullanÄ±cÄ± AdÄ±">
      <input type="password" id="adminPass" class="form-control mb-2" placeholder="Åžifre">
      <button class="btn btn-success" onclick="checkAdminLogin()">GiriÅŸ Yap</button>
    </div>
    <!-- ADMIN PANEL (BÄ°TÄ°Åž) -->



          <!-- Sekmeler -->
          <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="ekle-tab" data-coreui-toggle="tab" href="#ekle" role="tab">MÃ¼ÅŸteri Ekle</a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" id="tanima-tab" data-coreui-toggle="tab" href="#tanima" role="tab">YÃ¼z TanÄ±ma</a>
            </li>
            <li class="nav-item">
             <a class="nav-link" id="liste-tab" data-coreui-toggle="tab" href="#liste" role="tab" onclick="showAdminLogin('liste')">MÃ¼ÅŸteri Listesi</a>
            </li>
           <li class="nav-item">
             <a class="nav-link" id="bakiye-tab" data-coreui-toggle="tab" href="#bakiye" role="tab" onclick="showAdminLogin('bakiye')">Bakiye GÃ¼ncelle</a>
           </li>

              
          </ul>

          <!-- Ä°Ã§erik -->
          <div class="tab-content" id="myTabContent">


  
<!-- Bakiye GÃ¼ncelleme Paneli -->
<div class="tab-pane fade admin-content" id="bakiye" role="tabpanel" style="display: none;">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Bakiye GÃ¼ncelleme Paneli</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ä°sim</th>
            <th>Soyisim</th>
            <th>Bakiye</th>
            <th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody id="balanceTableBody">
          <!-- JavaScript ile doldurulacak -->
        </tbody>
      </table>
    </div>
  </div>
</div>

            <div class="tab-pane fade show active" id="ekle" role="tabpanel">
              <div class="card">
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Ä°sim</label>
                    <input type="text" class="form-control" id="name" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Soyisim</label>
                    <input type="text" class="form-control" id="surname" />
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Telefon</label>
                    <input type="text" class="form-control" id="phone" />
                  </div>
                  <button class="btn btn-warning w-100" onclick="addCustomer()">
                    Kaydet
                  </button>
                  
                </div>
              </div>
            </div>

<!-- Liste -->
<!-- MÃ¼ÅŸteri Listesi Paneli -->
<div class="tab-pane fade admin-content" id="liste" role="tabpanel" style="display: none;">
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">MÃ¼ÅŸteri Tablosu</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ä°sim</th>
            <th>Soyisim</th>
            <th>Telefon</th>
            <th>Ä°ÅŸlem</th>
          </tr>
        </thead>
        <tbody id="customerTableBody">
          <!-- SatÄ±rlar JavaScript ile eklenecek -->
        </tbody>
      </table>
    </div>
  </div>
</div>

  
  <!-- TanÄ±ma -->
  <div class="tab-pane fade" id="tanima" role="tabpanel">
    <div class="card">
      <div class="card-body text-center">
        <h5>ðŸ“· KasayÄ± BaÅŸlat</h5>
        <button class="btn btn-success mt-3" onclick="backend.startRecognition()">
          KasayÄ± BaÅŸlat
        </button>
      </div>
    </div>
  </div>
  </div> <!-- tab-content -->
  </main>
  </div> <!-- c-body -->
  </div> <!-- c-wrapper -->
  
  <!-- Toast -->
  <div class="toast-container">
    <div class="toast align-items-center border-0" id="toast-success" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toast-body">Ä°ÅŸlem baÅŸarÄ±lÄ±</div>
        <button type="button" class="btn-close me-2 m-auto" data-coreui-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  
  <!-- JS -->
  <script src="../static/coreui-5.3.1-dist/js/coreui.bundle.min.js"></script>
  <script src="../static/coreui-5.3.1-dist/js/qwebchannel.js"></script>
  
  <script>
    function showToast(msg) {
      const toastEl = document.getElementById("toast-success");
      const toastBody = document.getElementById("toast-body");
      toastBody.innerText = msg;
      const toast = new coreui.Toast(toastEl);
      toast.show();
    }
  
    function loadCustomers() {
      backend.getCustomerList().then(function(customers) {
        const tbody = document.getElementById("customerTableBody");
        tbody.innerHTML = "";
  
        customers.forEach(c => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${c.id}</td>
            <td>${c.isim}</td>
            <td>${c.soyisim}</td>
            <td>${c.telefon}</td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteCustomer(${c.id})">Sil</button></td>
          `;
          tbody.appendChild(row);
        });
      });
    }
  
    function deleteCustomer(id) {
      if (confirm("Bu mÃ¼ÅŸteriyi silmek istediÄŸinizden emin misiniz?")) {
        backend.deleteCustomer(id);
        showToast("MÃ¼ÅŸteri silindi");
        setTimeout(loadCustomers, 500);
      }
    }
  
    function addCustomer() {
      const name = document.getElementById("name").value;
      const surname = document.getElementById("surname").value;
      const phone = document.getElementById("phone").value;
  
      if (name && surname && phone) {
        backend.addCustomer(name, surname, phone);
        showToast("MÃ¼ÅŸteri kaydedildi");
        setTimeout(loadCustomers, 500);
      } else {
        showToast("LÃ¼tfen tÃ¼m alanlarÄ± doldurun");
      }
    }
  
window.onload = function () {
  // ðŸ”¥ Sayfa ilk aÃ§Ä±ldÄ±ÄŸÄ±nda admin iÃ§erikleri gizli kalsÄ±n
  document.querySelectorAll('.admin-content').forEach(el => {
    el.style.display = 'none';
  });

  new QWebChannel(qt.webChannelTransport, function (channel) {
    window.backend = channel.objects.backend;

    document.querySelector("button.btn-warning").onclick = addCustomer;

    loadCustomers();
    loadBalances();  // âœ… bakiye tablosunu da baÅŸtan yÃ¼kle
  });
};

  </script>
<script>
    function loadBalances() {
      if (!window.backend) {
        console.error("âŒ backend tanÄ±msÄ±z!");
        return;
      }
  
      backend.getAllCustomers().then(function (customers) {
        const tbody = document.getElementById("balanceTableBody");
        tbody.innerHTML = "";
  
        customers.forEach(c => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${c.id}</td>
            <td>${c.isim}</td>
            <td>${c.soyisim}</td>
            <td>${c.bakiye} TL</td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="updateBalance(${c.id}, '${c.isim}', '${c.soyisim}', ${c.bakiye})">GÃ¼ncelle</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
    }
  
    function updateBalance(id, isim, soyisim, eskiBakiye) {
      const yeni = prompt(`${isim} ${soyisim} iÃ§in yeni bakiye girin (eski: ${eskiBakiye} TL):`);
      if (yeni !== null && !isNaN(yeni)) {
        backend.updateCustomerBalance(id, parseFloat(yeni));
        showToast("Bakiye gÃ¼ncellendi");
        setTimeout(() => loadBalances(), 500);
      }
    }
  </script>
  
<script>
  let targetTab = '';

  function showAdminLogin(tabId) {
    targetTab = tabId;
    document.getElementById('adminLoginPanel').style.display = 'block';
  }

  function checkAdminLogin() {
    const user = document.getElementById('adminUser').value;
    const pass = document.getElementById('adminPass').value;

    if (user === 'admin' && pass === '1234') {
      // Admin paneli tamamen gÃ¶rÃ¼nmez olsun
      const panel = document.getElementById('adminLoginPanel');
      panel.style.display = 'none';

      // ðŸ”¥ Admin sekmelerini gÃ¶rÃ¼nÃ¼r yap
      document.querySelectorAll('.admin-content').forEach(el => {
        el.style.display = 'block';
      });

      // Sekmeyi aktif yap
      const tabTriggerEl = document.querySelector(`[href="#${targetTab}"]`);
      if (tabTriggerEl) {
        const tab = new coreui.Tab(tabTriggerEl);
        tab.show();
      }
    } else {
      alert('HatalÄ± kullanÄ±cÄ± adÄ± veya ÅŸifre!');
    }
  }
</script>



  
  </body>
  </html>